import{i as k,h as C,a as E,j as e,L as a,T as x,c,q as l}from"./index-Bl7s4VzA.js";import{u as d}from"./useMutation-CyJnlrj4.js";import{A as m}from"./arrow-left-Dp1lr5Kg.js";import{P as u}from"./package-CPkDHc9R.js";import{C as F}from"./circle-check-big-DBmni0CZ.js";function q(){const n=k(),{toast:r}=C(),{data:i=[],isLoading:h}=E({queryKey:[`/api/orders/${n}`]}),p=d({mutationFn:async t=>{const s=await fetch(`/api/orders/${t}/cancel`,{method:"PATCH"});if(!s.ok)throw new Error("Failed to cancel order");return s.json()},onSuccess:()=>{l.invalidateQueries({queryKey:[`/api/orders/${n}`]}),r({title:"Заказ отменен",description:"Ваш заказ успешно отменен"})},onError:()=>{r({title:"Ошибка",description:"Не удалось отменить заказ",variant:"destructive"})}}),g=d({mutationFn:async t=>{const s=await fetch(`/api/orders/${t}/repeat`,{method:"POST"});if(!s.ok)throw new Error("Failed to repeat order");return s.json()},onSuccess:()=>{l.invalidateQueries({queryKey:["/api/cart"]}),r({title:"Товары добавлены в корзину",description:"Товары из заказа добавлены в корзину"}),window.location.href="/cart"},onError:()=>{r({title:"Ошибка",description:"Не удалось повторить заказ",variant:"destructive"})}}),j=t=>{confirm("Вы уверены, что хотите отменить заказ?")&&p.mutate(t)},f=t=>{g.mutate(t)},y=d({mutationFn:async t=>{const s=await fetch(`/api/orders/${t}`,{method:"DELETE"});if(!s.ok)throw new Error("Failed to delete order");return s.json()},onSuccess:()=>{l.invalidateQueries({queryKey:[`/api/orders/${n}`]}),r({title:"Заказ удален",description:"Заказ успешно удален из истории"})},onError:()=>{r({title:"Ошибка",description:"Не удалось удалить заказ",variant:"destructive"})}}),o=t=>{confirm("Вы уверены, что хотите удалить заказ из истории?")&&y.mutate(t)},N=t=>{switch(t){case"pending":return"bg-orange-100 text-orange-700";case"preparing":return"bg-blue-100 text-blue-700";case"delivering":return"bg-purple-100 text-purple-700";case"delivered":return"bg-green-100 text-green-700";case"cancelled":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}},b=t=>{switch(t){case"pending":return c;case"preparing":return u;case"delivering":return x;case"delivered":return F;case"cancelled":return c;default:return c}},v=t=>{switch(t){case"pending":return"В обработке";case"preparing":return"Готовится";case"delivering":return"В доставке";case"delivered":return"Доставлен";case"cancelled":return"Отменен";default:return t}},w=t=>new Date(t).toLocaleDateString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"});return h?e.jsxs("div",{className:"pb-20",children:[e.jsx("header",{className:"bg-white dark:bg-card shadow-sm sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center p-4",children:[e.jsx(a,{href:"/profile",children:e.jsx("button",{className:"mr-3 p-2 -ml-2",children:e.jsx(m,{className:"w-6 h-6 text-gray-600"})})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"История заказов"})]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(t=>e.jsx("div",{className:"bg-gray-200 h-24 rounded-lg"},t))})})]}):e.jsxs("main",{className:"pb-20",children:[e.jsx("header",{className:"bg-white dark:bg-card shadow-sm sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center p-4",children:[e.jsx(a,{href:"/profile",children:e.jsx("button",{className:"mr-3 p-2 -ml-2",children:e.jsx(m,{className:"w-6 h-6 text-gray-600"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"История заказов"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[i.length," заказов"]})]})]})}),i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] p-8",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6",children:e.jsx(u,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Нет заказов"}),e.jsx("p",{className:"text-gray-500 text-center mb-6",children:"Вы еще не делали заказов в ДУЧАРКА"}),e.jsx(a,{href:"/catalog",children:e.jsx("button",{className:"bg-agent-purple text-white px-6 py-3 rounded-lg font-semibold",children:"Перейти в каталог"})})]}):e.jsx("section",{className:"p-4 space-y-4",children:i.map(t=>{const s=b(t.status);return e.jsxs("div",{className:"bg-white dark:bg-card rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:["Заказ №",t.id.slice(-6)]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.createdAt?w(t.createdAt):"Недавно"})]}),e.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${N(t.status)}`,children:[e.jsx(s,{className:"w-3 h-3"}),e.jsx("span",{children:v(t.status)})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Адрес доставки:"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:t.deliveryAddress})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:[parseFloat(t.totalAmount).toFixed(0)," с."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{href:`/order/${t.id}`,children:e.jsx("button",{className:"text-gray-500 text-sm font-medium hover:text-gray-700","data-testid":`button-order-details-${t.id.slice(-6)}`,children:"Подробнее"})}),t.status==="delivered"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f(t.id),className:"text-agent-purple text-sm font-medium hover:text-agent-purple/80",children:"Повторить"}),e.jsx("button",{onClick:()=>o(t.id),className:"text-red-500 text-lg font-medium hover:text-red-600",title:"Удалить заказ",children:"×"})]}),t.status==="cancelled"&&e.jsx("button",{onClick:()=>o(t.id),className:"text-red-500 text-lg font-medium hover:text-red-600",title:"Удалить заказ",children:"×"}),(t.status==="pending"||t.status==="preparing")&&e.jsx("button",{onClick:()=>j(t.id),className:"text-red-500 text-sm font-medium hover:text-red-600",children:"Отменить"})]})]}),t.status==="delivering"&&e.jsxs("div",{className:"mt-3 p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-purple-700 mb-2",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Курьер в пути"})]}),e.jsx("p",{className:"text-xs text-purple-600",children:"Ожидаемое время прибытия: 5-8 минут"})]})]},t.id)})})]})}export{q as default};
