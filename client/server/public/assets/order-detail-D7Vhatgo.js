import{k as E,g as L,s as P,h as q,i as F,r as p,a as M,j as e,L as c,B as i,T as d,t as D,c as o,q as j}from"./index-Bl7s4VzA.js";import{u as g}from"./useMutation-CyJnlrj4.js";import{A as x}from"./arrow-left-Dp1lr5Kg.js";import{C as m}from"./circle-check-big-DBmni0CZ.js";import{P as f}from"./package-CPkDHc9R.js";import{C as z}from"./copy-BJJ91Hok.js";import{C as O}from"./credit-card-BWVPYKp3.js";import{M as B}from"./message-circle-CED9PnL3.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=E("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);function X(){const{orderId:n}=L(),[,N]=P(),{toast:r}=q(),v=F(),[b,l]=p.useState(void 0),{data:s,isLoading:y,refetch:w}=M({queryKey:[`/api/orders/detail/${n}`],queryFn:async()=>{const t=await fetch(`/api/orders/detail/${n}`);if(!t.ok)throw new Error("Заказ не найден");return t.json()},refetchInterval:b,enabled:!!n});p.useEffect(()=>(s&&(s.status==="pending"||s.status==="preparing"||s.status==="delivering")?l(1e4):l(void 0),()=>l(void 0)),[s==null?void 0:s.status]);const h=g({mutationFn:async t=>{const a=await fetch(`/api/orders/${t}/cancel`,{method:"PATCH"});if(!a.ok)throw new Error("Failed to cancel order");return a.json()},onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/orders/${v}`]}),w(),r({title:"Заказ отменен",description:"Ваш заказ успешно отменен"})},onError:()=>{r({title:"Ошибка",description:"Не удалось отменить заказ",variant:"destructive"})}}),u=g({mutationFn:async t=>{const a=await fetch(`/api/orders/${t}/repeat`,{method:"POST"});if(!a.ok)throw new Error("Failed to repeat order");return a.json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/cart"]}),r({title:"Товары добавлены в корзину",description:"Товары из заказа добавлены в корзину"}),N("/checkout")},onError:()=>{r({title:"Ошибка",description:"Не удалось повторить заказ",variant:"destructive"})}}),k=t=>{switch(t){case"pending":return"bg-orange-100 text-orange-700";case"preparing":return"bg-blue-100 text-blue-700";case"delivering":return"bg-purple-100 text-purple-700";case"delivered":return"bg-green-100 text-green-700";case"cancelled":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}},C=t=>{switch(t){case"pending":return o;case"preparing":return f;case"delivering":return d;case"delivered":return m;case"cancelled":return o;default:return o}},I=t=>{switch(t){case"pending":return"В обработке";case"preparing":return"Готовится";case"delivering":return"В доставке";case"delivered":return"Доставлен";case"cancelled":return"Отменен";default:return t}},S=t=>{switch(t){case"pending":return"Ваш заказ принят и ожидает обработки";case"preparing":return"Заказ собирается на складе";case"delivering":return"Курьер в пути к вам";case"delivered":return"Заказ успешно доставлен";case"cancelled":return"Заказ был отменен";default:return""}},$=t=>new Date(t).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),T=()=>{navigator.clipboard.writeText((s==null?void 0:s.id)||""),r({title:"ID заказа скопирован",description:"Номер заказа скопирован в буфер обмена"})};if(y)return e.jsxs("div",{className:"pb-20",children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center p-4",children:[e.jsx(c,{href:"/orders",children:e.jsx("button",{className:"mr-3 p-2 -ml-2",children:e.jsx(x,{className:"w-6 h-6 text-gray-600"})})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Детали заказа"})]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3,4].map(t=>e.jsx("div",{className:"bg-gray-200 h-20 rounded-lg"},t))})})]});if(!s)return e.jsxs("div",{className:"pb-20",children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center p-4",children:[e.jsx(c,{href:"/orders",children:e.jsx("button",{className:"mr-3 p-2 -ml-2",children:e.jsx(x,{className:"w-6 h-6 text-gray-600"})})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Заказ не найден"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] p-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Заказ не найден"}),e.jsx("p",{className:"text-gray-500 text-center mb-6",children:"Возможно, заказ был удален или неверно указан номер"}),e.jsx(c,{href:"/orders",children:e.jsx(i,{children:"Вернуться к заказам"})})]})]});const A=C(s.status);return e.jsxs("main",{className:"pb-20",children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center p-4",children:[e.jsx(c,{href:"/orders",children:e.jsx("button",{className:"mr-3 p-2 -ml-2","data-testid":"button-back",children:e.jsx(x,{className:"w-6 h-6 text-gray-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900",children:["Заказ №",s.id.slice(-6)]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.createdAt?$(s.createdAt):"Недавно"})]})]})}),e.jsx("section",{className:"p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsxs("div",{className:`flex items-center space-x-2 px-4 py-2 rounded-full text-sm font-medium ${k(s.status)}`,children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:I(s.status)})]})}),e.jsx("p",{className:"text-center text-gray-600 mb-4",children:S(s.status)}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsxs("div",{className:`flex flex-col items-center ${s.status!=="cancelled"?"text-green-600":""}`,children:[e.jsx(m,{className:"w-4 h-4 mb-1"}),e.jsx("span",{children:"Принят"})]}),e.jsxs("div",{className:`flex flex-col items-center ${["preparing","delivering","delivered"].includes(s.status)?"text-green-600":""}`,children:[e.jsx(f,{className:"w-4 h-4 mb-1"}),e.jsx("span",{children:"Готовится"})]}),e.jsxs("div",{className:`flex flex-col items-center ${["delivering","delivered"].includes(s.status)?"text-green-600":""}`,children:[e.jsx(d,{className:"w-4 h-4 mb-1"}),e.jsx("span",{children:"В пути"})]}),e.jsxs("div",{className:`flex flex-col items-center ${s.status==="delivered"?"text-green-600":""}`,children:[e.jsx(m,{className:"w-4 h-4 mb-1"}),e.jsx("span",{children:"Доставлен"})]})]})]})}),e.jsxs("section",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Номер заказа"}),e.jsxs("p",{className:"text-sm text-gray-600 font-mono",children:["#",s.id.slice(-6)]})]}),e.jsx(i,{variant:"outline",size:"sm",onClick:T,"data-testid":"button-copy-order-id",children:e.jsx(z,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(D,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Адрес доставки"}),e.jsx("p",{className:"text-gray-600",children:s.deliveryAddress})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(O,{className:"w-5 h-5 text-purple-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Сумма заказа"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mb-2",children:[parseFloat(s.totalAmount).toFixed(0)," с."]}),s.promoCode&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-green-600",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:['Промокод "',s.promoCode,'" применен']})]})]})]})}),(s.comment||s.packerComment)&&e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Комментарии"}),s.comment&&e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Ваш комментарий:"}),e.jsx("p",{className:"text-gray-600",children:s.comment})]}),s.packerComment&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"От сборщика:"}),e.jsx("p",{className:"text-gray-600",children:s.packerComment})]})]})]})})]}),e.jsx("section",{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[s.status==="delivering"&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 text-center",children:[e.jsx(d,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("h3",{className:"font-semibold text-purple-900",children:"Курьер в пути!"}),e.jsx("p",{className:"text-sm text-purple-700 mb-3",children:"Ожидаемое время прибытия: 5-8 минут"}),e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"bg-purple-200 rounded-full h-2 mb-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full w-3/4"})}),e.jsx("p",{className:"text-xs text-purple-600",children:"Отслеживание в реальном времени"})]})]}),e.jsxs("div",{className:"space-y-2",children:[s.status==="delivered"&&e.jsx(i,{onClick:()=>u.mutate(s.id),className:"w-full bg-green-600 hover:bg-green-700",disabled:u.isPending,"data-testid":"button-repeat-order",children:"Повторить заказ"}),(s.status==="pending"||s.status==="preparing")&&e.jsx(i,{onClick:()=>h.mutate(s.id),variant:"destructive",className:"w-full",disabled:h.isPending,"data-testid":"button-cancel-order",children:"Отменить заказ"}),e.jsx(c,{href:"/orders",children:e.jsx(i,{variant:"outline",className:"w-full","data-testid":"button-back-to-orders",children:"Вернуться к заказам"})})]})]})})]})}export{X as default};
