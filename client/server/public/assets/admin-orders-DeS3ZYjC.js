import{k as j,s as Q,r as b,h as V,a as _,j as e,B as d,J,T as f,S as K,I as X,t as H,U as Z,q as G}from"./index-Bl7s4VzA.js";import{u as W}from"./useMutation-CyJnlrj4.js";import{C as n,a as c}from"./card-BQhqkSgn.js";import{B as C}from"./badge-B1g9d3Tj.js";import{S,a as A,b as F,c as L,d as r}from"./select-DoI496pU.js";import{A as T}from"./arrow-left-Dp1lr5Kg.js";import{P as $}from"./package-CPkDHc9R.js";import{C as B}from"./circle-alert-DLINg-_P.js";import{A as Y,D as ee,T as te}from"./trending-up-DD2WYl6H.js";import{C as N}from"./circle-check-big-DBmni0CZ.js";import{S as se}from"./star-42G-WcK6.js";import{E as ae}from"./eye-BlXai0ML.js";import"./index-BdQq_4o_.js";import"./index-1mwFcY8h.js";import"./index-B7K4-hLV.js";import"./index-C2xba8IL.js";import"./check-BlHW5vLV.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=j("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=j("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=j("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=j("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=j("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]),de={pending:{label:"Новый заказ",color:"bg-gradient-to-r from-amber-500 to-orange-500",textColor:"text-white",icon:B,bgLight:"bg-amber-50 dark:bg-amber-900/20",borderColor:"border-amber-200 dark:border-amber-800"},processing:{label:"В обработке",color:"bg-gradient-to-r from-blue-500 to-cyan-500",textColor:"text-white",icon:M,bgLight:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800"},delivering:{label:"Доставляется",color:"bg-gradient-to-r from-purple-500 to-indigo-500",textColor:"text-white",icon:f,bgLight:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-200 dark:border-purple-800"},completed:{label:"Выполнен",color:"bg-gradient-to-r from-green-500 to-emerald-500",textColor:"text-white",icon:N,bgLight:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800"},cancelled:{label:"Отменен",color:"bg-gradient-to-r from-red-500 to-pink-500",textColor:"text-white",icon:k,bgLight:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800"}};function Ce(){const[,p]=Q(),[h,P]=b.useState("all"),[o,I]=b.useState(""),[w,E]=b.useState("newest"),{toast:y}=V();b.useEffect(()=>{if(!localStorage.getItem("adminToken")){p("/admin/login");return}},[p]);const{data:l=[],isLoading:D,refetch:z}=_({queryKey:["/api/admin/orders"],queryFn:async()=>{const t=localStorage.getItem("adminToken"),s=await fetch("/api/admin/orders",{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw s.status===401?(p("/admin/login"),new Error("Unauthorized")):new Error("Failed to fetch orders");return s.json()}}),g=W({mutationFn:async({orderId:t,status:s})=>{const a=localStorage.getItem("adminToken"),m=await fetch(`/api/admin/orders/${t}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({status:s})});if(!m.ok)throw new Error("Failed to update order status");return m.json()},onSuccess:()=>{G.invalidateQueries({queryKey:["/api/admin/orders"]}),y({title:"Статус обновлен",description:"Статус заказа успешно изменен"})},onError:()=>{y({title:"Ошибка",description:"Не удалось обновить статус заказа",variant:"destructive"})}}),v=b.useMemo(()=>{let t=l;return h!=="all"&&(t=t.filter(s=>s.status===h)),o&&(t=t.filter(s=>{var a;return s.id.toLowerCase().includes(o.toLowerCase())||s.deliveryAddress.toLowerCase().includes(o.toLowerCase())||((a=s.userId)==null?void 0:a.toLowerCase().includes(o.toLowerCase()))})),t.sort((s,a)=>{switch(w){case"newest":return new Date(a.createdAt).getTime()-new Date(s.createdAt).getTime();case"oldest":return new Date(s.createdAt).getTime()-new Date(a.createdAt).getTime();case"amount_high":return parseFloat(a.totalAmount)-parseFloat(s.totalAmount);case"amount_low":return parseFloat(s.totalAmount)-parseFloat(a.totalAmount);default:return 0}})},[l,h,o,w]),x=b.useMemo(()=>{const t=l.length,s=l.filter(i=>i.status==="pending").length,a=l.filter(i=>i.status==="processing").length,m=l.filter(i=>i.status==="delivering").length,O=l.filter(i=>i.status==="completed").length,R=l.reduce((i,U)=>i+parseFloat(U.totalAmount),0);return{total:t,pending:s,processing:a,delivering:m,completed:O,totalRevenue:R}},[l]),u=(t,s)=>{g.mutate({orderId:t,status:s})},q=t=>new Date(t).toLocaleString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"});return D?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-b border-white/20 dark:border-slate-700/50 sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16",children:e.jsxs("div",{className:"flex items-center h-16 lg:h-20",children:[e.jsx(d,{variant:"ghost",onClick:()=>p("/admin"),className:"mr-3 p-2 -ml-2","data-testid":"button-back",children:e.jsx(T,{className:"w-5 h-5"})}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-48 animate-pulse"})]})})}),e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(t=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-lg"},t))}),e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-xl"},t))})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-b border-white/20 dark:border-slate-700/50 sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16",children:e.jsxs("div",{className:"flex items-center justify-between h-16 lg:h-20",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(d,{variant:"ghost",onClick:()=>p("/admin"),className:"mr-3 p-2 -ml-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors duration-200","data-testid":"button-back",children:e.jsx(T,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500 to-red-500 rounded-xl blur opacity-75 animate-pulse"}),e.jsx("div",{className:"relative bg-gradient-to-r from-orange-500 to-red-500 p-3 rounded-xl",children:e.jsx(ie,{className:"w-6 h-6 lg:w-7 lg:h-7 text-white"})})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl lg:text-2xl xl:text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-600 dark:from-white dark:to-slate-300 bg-clip-text text-transparent",children:"Управление заказами"}),e.jsxs("p",{className:"text-sm lg:text-base text-slate-500 dark:text-slate-400",children:[v.length," из ",l.length," заказов"]})]})]})]}),e.jsxs(d,{onClick:()=>z(),variant:"outline",className:"bg-white/50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200","data-testid":"button-refresh",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Обновить"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16 py-6 lg:py-8",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4 lg:gap-6 mb-8",children:[e.jsx(n,{className:"bg-gradient-to-br from-blue-500 via-blue-600 to-blue-700 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:e.jsxs(c,{className:"p-4 lg:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx($,{className:"w-6 h-6 lg:w-8 lg:h-8 text-blue-100"}),e.jsx(C,{className:"bg-white/20 text-white border-white/30 text-xs",children:"Всего"})]}),e.jsx("p",{className:"text-2xl lg:text-3xl font-bold mb-1",children:x.total}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Всех заказов"})]})}),e.jsx(n,{className:"bg-gradient-to-br from-amber-500 via-orange-500 to-red-500 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:e.jsxs(c,{className:"p-4 lg:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(B,{className:"w-6 h-6 lg:w-8 lg:h-8 text-orange-100"}),x.pending>0&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-2xl lg:text-3xl font-bold mb-1",children:x.pending}),e.jsx("p",{className:"text-orange-100 text-sm",children:"Новых"})]})}),e.jsx(n,{className:"bg-gradient-to-br from-purple-500 via-purple-600 to-indigo-600 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:e.jsxs(c,{className:"p-4 lg:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(f,{className:"w-6 h-6 lg:w-8 lg:h-8 text-purple-100"}),x.delivering>0&&e.jsx(Y,{className:"w-4 h-4 text-purple-100 animate-pulse"})]}),e.jsx("p",{className:"text-2xl lg:text-3xl font-bold mb-1",children:x.delivering}),e.jsx("p",{className:"text-purple-100 text-sm",children:"В доставке"})]})}),e.jsx(n,{className:"bg-gradient-to-br from-green-500 via-green-600 to-emerald-600 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:e.jsxs(c,{className:"p-4 lg:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(N,{className:"w-6 h-6 lg:w-8 lg:h-8 text-green-100"}),e.jsx(se,{className:"w-4 h-4 text-green-100"})]}),e.jsx("p",{className:"text-2xl lg:text-3xl font-bold mb-1",children:x.completed}),e.jsx("p",{className:"text-green-100 text-sm",children:"Выполнено"})]})}),e.jsx(n,{className:"bg-gradient-to-br from-emerald-500 via-emerald-600 to-green-600 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:e.jsxs(c,{className:"p-4 lg:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ee,{className:"w-6 h-6 lg:w-8 lg:h-8 text-emerald-100"}),e.jsx(te,{className:"w-4 h-4 text-emerald-100"})]}),e.jsxs("p",{className:"text-2xl lg:text-3xl font-bold mb-1",children:[x.totalRevenue.toFixed(0),"₽"]}),e.jsx("p",{className:"text-emerald-100 text-sm",children:"Выручка"})]})})]}),e.jsx(n,{className:"bg-white/70 dark:bg-slate-900/70 backdrop-blur-sm border-white/20 dark:border-slate-700/50 shadow-lg mb-6",children:e.jsx(c,{className:"p-4 lg:p-6",children:e.jsx("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(X,{placeholder:"Поиск по номеру, адресу, пользователю...",value:o,onChange:t=>I(t.target.value),className:"pl-10 bg-white/50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700","data-testid":"input-search"})]}),e.jsxs(S,{value:h,onValueChange:P,children:[e.jsxs(A,{className:"w-full sm:w-48 bg-white/50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700","data-testid":"select-status-filter",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),e.jsx(F,{placeholder:"Все статусы"})]}),e.jsxs(L,{children:[e.jsx(r,{value:"all",children:"Все статусы"}),e.jsx(r,{value:"pending",children:"Новые заказы"}),e.jsx(r,{value:"processing",children:"В обработке"}),e.jsx(r,{value:"delivering",children:"Доставляются"}),e.jsx(r,{value:"completed",children:"Выполненные"}),e.jsx(r,{value:"cancelled",children:"Отмененные"})]})]}),e.jsxs(S,{value:w,onValueChange:E,children:[e.jsx(A,{className:"w-full sm:w-48 bg-white/50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700","data-testid":"select-sort",children:e.jsx(F,{placeholder:"Сортировка"})}),e.jsxs(L,{children:[e.jsx(r,{value:"newest",children:"Сначала новые"}),e.jsx(r,{value:"oldest",children:"Сначала старые"}),e.jsx(r,{value:"amount_high",children:"По сумме (убыв.)"}),e.jsx(r,{value:"amount_low",children:"По сумме (возр.)"})]})]})]})})})}),e.jsx("div",{className:"space-y-4 lg:space-y-6",children:v.length===0?e.jsx(n,{className:"bg-white/70 dark:bg-slate-900/70 backdrop-blur-sm border-white/20 dark:border-slate-700/50 shadow-lg",children:e.jsxs(c,{className:"p-8 lg:p-12 text-center",children:[e.jsx($,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100 mb-2",children:o||h!=="all"?"Заказы не найдены":"Нет заказов"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:o||h!=="all"?"Попробуйте изменить фильтры поиска":"Пока нет ни одного заказа в системе"})]})}):v.map(t=>{var m;const s=de[t.status],a=s.icon;return e.jsx(n,{className:"bg-white/70 dark:bg-slate-900/70 backdrop-blur-sm border-white/20 dark:border-slate-700/50 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02] overflow-hidden group",children:e.jsx(c,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"flex-1 p-4 lg:p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.color} shadow-lg`,children:e.jsx(a,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg lg:text-xl font-bold text-slate-900 dark:text-slate-100 mb-1",children:["Заказ №",t.id.slice(-6)]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-slate-500 dark:text-slate-400",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{children:q(t.createdAt)})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(C,{className:`${s.color} ${s.textColor} border-0 shadow-md text-sm px-3 py-1`,children:s.label}),e.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:[parseFloat(t.totalAmount).toFixed(0),"₽"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(H,{className:"w-4 h-4 text-slate-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Адрес доставки:"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.deliveryAddress})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Z,{className:"w-4 h-4 text-slate-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Пользователь:"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 font-mono",children:((m=t.userId)==null?void 0:m.slice(-8))||"Неизвестно"})]})]})]}),t.comment&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Комментарий к заказу:"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.comment})]})]}),e.jsxs("div",{className:"lg:w-64 bg-slate-50/50 dark:bg-slate-800/30 p-4 lg:p-6 border-t lg:border-t-0 lg:border-l border-slate-200 dark:border-slate-700",children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"Действия"}),e.jsxs("div",{className:"space-y-2",children:[t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{onClick:()=>u(t.id,"processing"),disabled:g.isPending,className:"w-full bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white border-0 shadow-md hover:shadow-lg transition-all duration-200","data-testid":`button-accept-${t.id}`,children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Принять в работу"]}),e.jsxs(d,{onClick:()=>u(t.id,"cancelled"),disabled:g.isPending,variant:"outline",className:"w-full border-red-200 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-900/20","data-testid":`button-cancel-${t.id}`,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Отменить"]})]}),t.status==="processing"&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{onClick:()=>u(t.id,"delivering"),disabled:g.isPending,className:"w-full bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white border-0 shadow-md hover:shadow-lg transition-all duration-200","data-testid":`button-deliver-${t.id}`,children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Отправить"]}),e.jsxs(d,{onClick:()=>u(t.id,"cancelled"),disabled:g.isPending,variant:"outline",className:"w-full border-red-200 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-900/20","data-testid":`button-cancel-${t.id}`,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Отменить"]})]}),t.status==="delivering"&&e.jsxs(d,{onClick:()=>u(t.id,"completed"),disabled:g.isPending,className:"w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white border-0 shadow-md hover:shadow-lg transition-all duration-200","data-testid":`button-complete-${t.id}`,children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Завершить"]}),(t.status==="completed"||t.status==="cancelled")&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:t.status==="completed"?"Заказ выполнен":"Заказ отменен"})}),e.jsxs(d,{variant:"outline",className:"w-full mt-2 border-slate-200 text-slate-600 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-400 dark:hover:bg-slate-800","data-testid":`button-details-${t.id}`,children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Подробности"]})]})]})]})})},t.id)})})]})]})}export{Ce as default};
