import{k as O,r as g,h as I,a as K,j as e,B as n,J as P,P as Q,I as u,q as o}from"./index-Bl7s4VzA.js";import{u as j}from"./useMutation-CyJnlrj4.js";import{L as r}from"./label-s7AvLBDK.js";import{T as z}from"./textarea-BsUlHnI9.js";import{S as v,a as f,b,c as y,d as a}from"./select-DoI496pU.js";import{C as M,b as R,c as $,a as J}from"./card-BQhqkSgn.js";import{D as C,a as G,b as w,c as T,d as S}from"./dialog-DCOcG2c2.js";import{A as H}from"./arrow-left-Dp1lr5Kg.js";import{G as U}from"./globe-DFSHuZIP.js";import{E as W}from"./eye-BlXai0ML.js";import{E as X}from"./eye-off-BHx-9Aap.js";import{T as Y}from"./trash-2-B9XP7aVc.js";import"./index-BdQq_4o_.js";import"./index-1mwFcY8h.js";import"./index-B7K4-hLV.js";import"./index-C2xba8IL.js";import"./check-BlHW5vLV.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=O("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),F=({banner:t,onSubmit:h,isLoading:l})=>{var c;return e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"title",children:"Заголовок"}),e.jsx(u,{id:"title",name:"title",defaultValue:(t==null?void 0:t.title)||"",placeholder:"Заголовок баннера",required:!0,"data-testid":"input-banner-title"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"subtitle",children:"Подзаголовок"}),e.jsx(u,{id:"subtitle",name:"subtitle",defaultValue:(t==null?void 0:t.subtitle)||"",placeholder:"Подзаголовок","data-testid":"input-banner-subtitle"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"message",children:"Описание"}),e.jsx(z,{id:"message",name:"message",defaultValue:(t==null?void 0:t.message)||"",placeholder:"Описание баннера",required:!0,"data-testid":"textarea-banner-message"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"type",children:"Тип баннера"}),e.jsxs(v,{name:"type",defaultValue:(t==null?void 0:t.type)||"info",children:[e.jsx(f,{"data-testid":"select-banner-type",children:e.jsx(b,{placeholder:"Выберите тип"})}),e.jsxs(y,{children:[e.jsx(a,{value:"info",children:"Информация"}),e.jsx(a,{value:"promotional",children:"Промо"}),e.jsx(a,{value:"announcement",children:"Объявление"}),e.jsx(a,{value:"partnership",children:"Партнерство"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"priority",children:"Приоритет"}),e.jsxs(v,{name:"priority",defaultValue:((c=t==null?void 0:t.priority)==null?void 0:c.toString())||"1",children:[e.jsx(f,{"data-testid":"select-banner-priority",children:e.jsx(b,{placeholder:"Выберите приоритет"})}),e.jsxs(y,{children:[e.jsx(a,{value:"1",children:"Низкий (1)"}),e.jsx(a,{value:"2",children:"Средний (2)"}),e.jsx(a,{value:"3",children:"Высокий (3)"}),e.jsx(a,{value:"4",children:"Критический (4)"}),e.jsx(a,{value:"5",children:"Экстренный (5)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"backgroundColor",children:"Цвет фона"}),e.jsx(u,{id:"backgroundColor",name:"backgroundColor",type:"color",defaultValue:(t==null?void 0:t.backgroundColor)||"#6366f1","data-testid":"input-banner-bg-color"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"textColor",children:"Цвет текста"}),e.jsx(u,{id:"textColor",name:"textColor",type:"color",defaultValue:(t==null?void 0:t.textColor)||"#ffffff","data-testid":"input-banner-text-color"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"buttonText",children:"Текст кнопки"}),e.jsx(u,{id:"buttonText",name:"buttonText",defaultValue:(t==null?void 0:t.buttonText)||"",placeholder:"Текст кнопки (необязательно)","data-testid":"input-banner-button-text"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"buttonLink",children:"Ссылка кнопки"}),e.jsx(u,{id:"buttonLink",name:"buttonLink",defaultValue:(t==null?void 0:t.buttonLink)||"",placeholder:"URL (необязательно)","data-testid":"input-banner-button-link"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"isActive",children:"Статус"}),e.jsxs(v,{name:"isActive",defaultValue:t!=null&&t.isActive?"true":"false",children:[e.jsx(f,{"data-testid":"select-banner-status",children:e.jsx(b,{placeholder:"Выберите статус"})}),e.jsxs(y,{children:[e.jsx(a,{value:"true",children:"Активен"}),e.jsx(a,{value:"false",children:"Неактивен"})]})]})]}),e.jsx(n,{type:"submit",disabled:l,className:"w-full","data-testid":"button-save-banner",children:l?"Сохраняем...":"Сохранить"})]})};function ge(){const[t,h]=g.useState(!1),[l,c]=g.useState(null),[m,N]=g.useState(!1),{toast:d}=I(),{data:L=[],isLoading:A}=K({queryKey:["/api/banners/all"],staleTime:0,gcTime:0,refetchOnWindowFocus:!1,refetchOnMount:!0}),k=j({mutationFn:s=>fetch("/api/banners",{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(i=>i.json()),onSuccess:()=>{d({title:"Баннер создан",description:"Новый баннер успешно добавлен"}),o.invalidateQueries({queryKey:["/api/banners"]}),h(!1)},onError:()=>{d({title:"Ошибка",description:"Не удалось создать баннер",variant:"destructive"})}}),p=j({mutationFn:({id:s,...i})=>fetch(`/api/banners/${s}`,{method:"PUT",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then(x=>x.json()),onSuccess:()=>{d({title:"Баннер обновлен",description:"Изменения сохранены"}),o.invalidateQueries({queryKey:["/api/banners"]}),c(null)},onError:()=>{d({title:"Ошибка",description:"Не удалось обновить баннер",variant:"destructive"})}}),D=j({mutationFn:s=>fetch(`/api/banners/${s}`,{method:"DELETE"}),onSuccess:()=>{d({title:"Баннер удален",description:"Баннер успешно удален"}),o.invalidateQueries({queryKey:["/api/banners"]})},onError:()=>{d({title:"Ошибка",description:"Не удалось удалить баннер",variant:"destructive"})}}),E=s=>{s.preventDefault();const i=new FormData(s.currentTarget),x={title:i.get("title"),subtitle:i.get("subtitle"),message:i.get("message"),type:i.get("type"),priority:parseInt(i.get("priority")),backgroundColor:i.get("backgroundColor"),textColor:i.get("textColor"),buttonText:i.get("buttonText")||void 0,buttonLink:i.get("buttonLink")||void 0,isActive:i.get("isActive")==="true"};k.mutate(x)},q=s=>{if(s.preventDefault(),!l)return;const i=new FormData(s.currentTarget),x={id:l.id,title:i.get("title"),subtitle:i.get("subtitle"),message:i.get("message"),type:i.get("type"),priority:parseInt(i.get("priority")),backgroundColor:i.get("backgroundColor"),textColor:i.get("textColor"),buttonText:i.get("buttonText")||void 0,buttonLink:i.get("buttonLink")||void 0,isActive:i.get("isActive")==="true"};p.mutate(x)},V=s=>{p.mutate({id:s.id,isActive:!s.isActive})},B=async()=>{N(!0);try{await o.invalidateQueries({queryKey:["/api/banners"]}),await o.invalidateQueries({queryKey:["/api/banners/all"]}),await o.refetchQueries({queryKey:["/api/banners"]}),await o.refetchQueries({queryKey:["/api/banners/all"]}),d({title:"Кеш обновлен",description:"Изменения должны быть видны на главной странице"})}catch{d({title:"Ошибка",description:"Не удалось обновить кеш",variant:"destructive"})}finally{N(!1)}};return A?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-6"}),e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},s))})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-b border-white/20 dark:border-slate-700/50 sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16",children:e.jsxs("div",{className:"flex items-center justify-between h-16 lg:h-20",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(n,{variant:"ghost",onClick:()=>window.history.back(),className:"mr-3 p-2 -ml-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors duration-200","data-testid":"button-back",children:e.jsx(H,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl blur opacity-75 animate-pulse"}),e.jsx("div",{className:"relative bg-gradient-to-r from-purple-500 to-pink-500 p-3 rounded-xl",children:e.jsx(U,{className:"w-6 h-6 lg:w-7 lg:h-7 text-white"})})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl lg:text-2xl xl:text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-600 dark:from-white dark:to-slate-300 bg-clip-text text-transparent",children:"Управление баннерами"}),e.jsx("p",{className:"text-sm lg:text-base text-slate-500 dark:text-slate-400",children:"Промо контент и объявления"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(n,{variant:"outline",onClick:B,disabled:m,className:"bg-white/50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200","data-testid":"button-refresh-cache",children:[e.jsx(P,{className:`w-4 h-4 mr-2 ${m?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:m?"Обновление...":"Обновить кеш"})]}),e.jsxs(C,{open:t,onOpenChange:h,children:[e.jsx(G,{asChild:!0,children:e.jsxs(n,{className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white border-0 shadow-md hover:shadow-lg transition-all duration-200","data-testid":"button-create-banner",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Создать баннер"]})}),e.jsxs(w,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(S,{children:"Создать новый баннер"})}),e.jsx(F,{onSubmit:E,isLoading:k.isPending})]})]})]})]})})}),e.jsx("div",{className:"container mx-auto p-6 space-y-6",children:L.map(s=>e.jsxs(M,{className:"overflow-hidden",children:[e.jsx(R,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{className:"text-lg",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>V(s),"data-testid":`button-toggle-${s.id}`,children:s.isActive?e.jsx(W,{className:"w-4 h-4"}):e.jsx(X,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>c(s),"data-testid":`button-edit-${s.id}`,children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>D.mutate(s.id),"data-testid":`button-delete-${s.id}`,children:e.jsx(Y,{className:"w-4 h-4"})})]})]})}),e.jsx(J,{children:e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg border-2 border-gray-200 flex items-center justify-center text-white text-xs font-semibold",style:{backgroundColor:s.backgroundColor||"#6366f1"},children:"Цвет"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.message}),e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Тип: ",s.type]}),e.jsxs("span",{children:["Приоритет: ",s.priority]}),e.jsxs("span",{children:["Статус: ",s.isActive?"Активен":"Неактивен"]})]})]})]})})]},s.id))}),e.jsx(C,{open:!!l,onOpenChange:()=>c(null),children:e.jsxs(w,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(S,{children:"Редактировать баннер"})}),l&&e.jsx(F,{banner:l,onSubmit:q,isLoading:p.isPending})]})})]})}export{ge as default};
