import{k as j,r as d,j as e,X as I,u as L,i as M,h as A,F as B,s as P,a as S,U as T,L as w,b as $,G,B as R,J as y,K as O,t as E,c as F}from"./index-Bl7s4VzA.js";import{g as v,l as k}from"./auth-state-B9eIdUwI.js";import{s as H,D as q,I as U}from"./pwa-utils-3wKQgzN6.js";import{S as z}from"./smartphone-anWcFTs4.js";import{A as K}from"./app-header-Ch0F_p7N.js";import{L as D}from"./log-out-Dr9lMJEl.js";import{C as J}from"./credit-card-BWVPYKp3.js";import{B as Q}from"./bell-BieROCbd.js";import{C as V}from"./circle-help-DSCW-f3j.js";import"./dialog-DCOcG2c2.js";import"./index-B7K4-hLV.js";import"./index-1mwFcY8h.js";import"./index-BdQq_4o_.js";import"./badge-B1g9d3Tj.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=j("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=j("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=j("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Y=({id:i,title:l,description:m,position:u="top",trigger:a="hover",autoShowDelay:t=3e3,children:b})=>{const[o,n]=d.useState(!1),[x,p]=d.useState(!1),h=`ducharkha_tooltip_${i}`;d.useEffect(()=>{const r=localStorage.getItem(h);if(p(!!r),!r&&a==="auto"){const c=setTimeout(()=>{n(!0)},t);return()=>clearTimeout(c)}},[h,a,t]);const g=()=>{(!x||a!=="auto")&&n(!0)},f=()=>{n(!1),x||(localStorage.setItem(h,"shown"),p(!0))},N={top:"bottom-full left-1/2 transform -translate-x-1/2 mb-2",bottom:"top-full left-1/2 transform -translate-x-1/2 mt-2",left:"right-full top-1/2 transform -translate-y-1/2 mr-2",right:"left-full top-1/2 transform -translate-y-1/2 ml-2"},s={top:"top-full left-1/2 transform -translate-x-1/2 border-t-gray-800 border-t-8 border-x-transparent border-x-8",bottom:"bottom-full left-1/2 transform -translate-x-1/2 border-b-gray-800 border-b-8 border-x-transparent border-x-8",left:"left-full top-1/2 transform -translate-y-1/2 border-l-gray-800 border-l-8 border-y-transparent border-y-8",right:"right-full top-1/2 transform -translate-y-1/2 border-r-gray-800 border-r-8 border-y-transparent border-y-8"};return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{onMouseEnter:a==="hover"?g:void 0,onMouseLeave:a==="hover"?f:void 0,onClick:a==="click"?()=>n(!o):void 0,className:a==="click"?"cursor-pointer":"",children:b}),o&&e.jsxs("div",{className:`absolute z-50 ${N[u]}`,children:[e.jsxs("div",{className:"bg-gray-800 text-white rounded-lg p-3 shadow-lg max-w-xs",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{className:"w-4 h-4 text-yellow-400 flex-shrink-0"}),e.jsx("h4",{className:"font-medium text-sm",children:l})]}),e.jsx("button",{onClick:f,className:"p-1 hover:bg-gray-700 rounded-full ml-2 flex-shrink-0","data-testid":`button-close-tooltip-${i}`,children:e.jsx(I,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-xs text-gray-200 leading-relaxed",children:m})]}),e.jsx("div",{className:`absolute w-0 h-0 ${s[u]}`})]})]})};function Z(){const{showInstallBanner:i,isInstalling:l,handleInstall:m}=L();return i?e.jsxs("div",{className:"mx-4 mb-4 bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl p-4 text-white shadow-lg relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 opacity-10",children:[e.jsx("div",{className:"absolute -top-4 -right-4 w-24 h-24 bg-white rounded-full"}),e.jsx("div",{className:"absolute -bottom-2 -left-2 w-16 h-16 bg-white rounded-full"})]}),e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("div",{className:"bg-white bg-opacity-20 p-3 rounded-lg mr-4",children:e.jsx(z,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Установите приложение ДУЧАРХА"}),e.jsx("p",{className:"text-sm text-purple-100 mb-3",children:"Быстрый доступ с главного экрана • Работает офлайн • Без рекламы браузера"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:m,disabled:l,className:"bg-white text-purple-600 px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-2 hover:bg-purple-50 transition-colors disabled:opacity-50","data-testid":"button-install-pwa",children:H()?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4"}),l?"Установка...":"Установить"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4"}),"Как установить"]})})})]})]})]}):null}function pe(){const i=M(),{toast:l}=A(),{startOnboarding:m,isOnboardingComplete:u}=B(),[,a]=P(),[t,b]=d.useState(()=>v()),[o,n]=d.useState({name:(t==null?void 0:t.name)||"Пользователь",email:t!=null&&t.isGuest?"":"Ducharha@gmail.com",phone:(t==null?void 0:t.phone)||"",address:"ул. Джами "}),x=()=>{l({title:"Обновление сессии",description:"Очищаем кэш и перезагружаем приложение..."}),setTimeout(()=>{O()},1e3)},p=()=>{l({title:"Запуск введения",description:"Покажем вам основные возможности приложения"}),setTimeout(()=>{m()},500)},h=()=>{t!=null&&t.isGuest?(k(),a("/profile"),l({title:"Создание аккаунта",description:"Войдите или создайте профиль для получения полного доступа"})):(k(),a("/profile"),l({title:"Выход выполнен",description:"Вы успешно вышли из системы"}))};d.useEffect(()=>{const s=v();b(s),s&&n(c=>({...c,name:s.name||"Пользователь",phone:s.phone||"",email:s.isGuest?"":c.email}));const r=localStorage.getItem("userProfile");if(r&&!(s!=null&&s.isAuthenticated)){const c=JSON.parse(r);n(C=>({...C,...c}))}},[]),S({queryKey:["/api/orders",i]});const g=[{icon:E,label:"Адреса доставки",description:"Управление адресами",href:"/addresses"},{icon:F,label:"История заказов",description:"Ваши покупки",href:"/orders"},{icon:J,label:"Способы оплаты",description:"Карты и кошельки",href:"/payment-methods"},{icon:Q,label:"Уведомления",description:"Настройки push",href:"/notifications"},{icon:V,label:"Помощь",description:"FAQ и поддержка",href:"/help"}],f=[{icon:_,label:"Показать гид",description:"Повторить введение",action:p},{icon:y,label:"Обновить сессию",description:"Очистить кэш",action:x}];return e.jsxs("main",{className:"min-h-screen bg-background pb-20",children:[e.jsx(K,{title:"Профиль",showBack:!1,showNotifications:!1}),e.jsx("section",{className:"p-4",children:e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-agent-purple/10 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"w-8 h-8 text-agent-purple"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:o.name}),(t==null?void 0:t.isGuest)&&e.jsx("p",{className:"text-sm text-orange-600",children:"Гостевой режим"}),!(t!=null&&t.isGuest)&&o.email&&e.jsx("p",{className:"text-sm text-gray-500",children:o.email}),o.phone&&e.jsx("p",{className:"text-sm text-gray-500",children:o.phone})]}),e.jsx(w,{href:"/profile/edit",children:e.jsx("button",{className:"p-2 text-gray-400 hover:text-agent-purple",children:e.jsx(X,{className:"w-5 h-5"})})})]})})}),e.jsx("section",{className:"px-4 pb-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[g.map(s=>e.jsx(w,{href:s.href,children:e.jsxs("button",{className:"w-full p-4 flex items-center space-x-3 hover:bg-gray-50 transition-colors border-b border-gray-100",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(s.icon,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.label}),e.jsx("p",{className:"text-sm text-gray-500",children:s.description})]}),e.jsx($,{className:"w-4 h-4 text-gray-400"})]})},s.href)),e.jsx("div",{className:"bg-gray-100 px-4 py-2",children:e.jsx("p",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Приложение"})}),f.map((s,r)=>e.jsx(Y,{id:`profile-action-${r}`,title:"Полезная функция",description:s.label==="Показать гид"?"Нажмите, чтобы повторно просмотреть введение в приложение с основными возможностями":"Очистите кэш если приложение работает некорректно",trigger:"hover",children:e.jsxs("button",{onClick:s.action,className:"w-full p-4 flex items-center space-x-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0","data-testid":`button-${s.label.toLowerCase().replace(/\s+/g,"-")}`,children:[e.jsx("div",{className:`w-10 h-10 ${s.label==="Показать гид"?"bg-purple-100":"bg-blue-100"} rounded-lg flex items-center justify-center`,children:e.jsx(s.icon,{className:`w-5 h-5 ${s.label==="Показать гид"?"text-purple-600":"text-blue-600"}`})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.label}),e.jsx("p",{className:"text-sm text-gray-500",children:s.description})]}),s.label==="Показать гид"&&e.jsx(G,{className:"w-4 h-4 text-purple-500"})]})},s.label))]})}),e.jsx("section",{className:"px-4 pb-4",children:e.jsx(Z,{})}),e.jsxs("section",{className:"px-4 pb-8",children:[e.jsxs("button",{onClick:h,className:"w-full bg-white rounded-xl p-4 shadow-sm flex items-center justify-center space-x-2 text-red-500 hover:bg-red-50 transition-colors","data-testid":"button-logout",children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:t!=null&&t.isGuest?"Войти в аккаунт":"Выйти"})]}),e.jsx("div",{className:"text-center py-2 cursor-pointer",onClick:s=>{const r=parseInt(s.currentTarget.dataset.clicks||"0")+1;s.currentTarget.dataset.clicks=r.toString(),r>=5&&(window.location.href="/admin/login")},children:e.jsx("p",{className:"text-xs text-gray-400",children:"ДУЧАРХА v2.0.0"})})]}),e.jsx("section",{className:"p-4",children:e.jsxs("div",{className:"bg-white dark:bg-card rounded-xl p-4 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Настройки приложения"}),e.jsxs(R,{onClick:x,variant:"outline",className:"w-full mb-3","data-testid":"button-refresh-session",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Обновить приложение"]}),!1]})})]})}export{pe as default};
