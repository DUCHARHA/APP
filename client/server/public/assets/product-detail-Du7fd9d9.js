import{k as f,r as x,j as e,l as w,m as k,g as C,h as q,i as O,a as P,L as p,B as g,M as S,P as I,n as L,o as A,q as T}from"./index-Bl7s4VzA.js";import{u as E}from"./useMutation-CyJnlrj4.js";import{B as M}from"./badge-B1g9d3Tj.js";import{C as d,a as o}from"./card-BQhqkSgn.js";import{A as R}from"./arrow-left-Dp1lr5Kg.js";import{S as z}from"./star-42G-WcK6.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=f("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=f("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);var B="Separator",j="horizontal",$=["horizontal","vertical"],y=x.forwardRef((a,r)=>{const{decorative:n,orientation:i=j,...l}=a,t=U(i)?i:j,c=n?{role:"none"}:{"aria-orientation":t==="vertical"?t:void 0,role:"separator"};return e.jsx(w.div,{"data-orientation":t,...c,...l,ref:r})});y.displayName=B;function U(a){return $.includes(a)}var b=y;const N=x.forwardRef(({className:a,orientation:r="horizontal",decorative:n=!0,...i},l)=>e.jsx(b,{ref:l,decorative:n,orientation:r,className:k("shrink-0 bg-border",r==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",a),...i}));N.displayName=b.displayName;function G(){const{productId:a}=C(),[r,n]=x.useState(1),{toast:i}=q(),l=O(),{data:t,isLoading:m}=P({queryKey:["/api/products",a],queryFn:()=>fetch(`/api/products/${a}`).then(s=>s.json())}),c=E({mutationFn:()=>A("/api/cart","POST",{userId:l,productId:a,quantity:r}),onSuccess:()=>{T.invalidateQueries({queryKey:["/api/cart"]})},onError:()=>{i({title:"Ошибка",description:"Не удалось добавить товар в корзину",variant:"destructive"})}});if(m)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-agent-purple mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Загрузка товара..."})]})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Товар не найден"}),e.jsx(p,{href:"/catalog",children:e.jsx(g,{variant:"outline",children:"Вернуться в каталог"})})]})});const h=[{label:"Калории",value:t.calories,unit:"ккал"},{label:"Белки",value:t.proteins,unit:"г"},{label:"Жиры",value:t.fats,unit:"г"},{label:"Углеводы",value:t.carbs,unit:"г"},{label:"Клетчатка",value:t.fiber,unit:"г"},{label:"Сахар",value:t.sugar,unit:"г"}].filter(s=>s.value),u=s=>{const v=Math.max(1,r+s);n(v)};return e.jsxs("main",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx(p,{href:"/catalog",children:e.jsx("button",{className:"p-2 -ml-2","data-testid":"button-back",children:e.jsx(R,{className:"w-6 h-6 text-gray-600"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 flex-1 text-center px-4 truncate",children:t.name}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"p-2","data-testid":"button-favorite",children:e.jsx(F,{className:"w-5 h-5 text-gray-400"})}),e.jsx("button",{className:"p-2","data-testid":"button-share",children:e.jsx(Q,{className:"w-5 h-5 text-gray-400"})})]})]})}),e.jsx("section",{className:"bg-white",children:e.jsxs("div",{className:"aspect-square relative overflow-hidden",children:[e.jsx("img",{src:t.imageUrl||"https://images.unsplash.com/photo-1546069901-ba9599a7e63c?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400",alt:t.name,className:"w-full h-full object-cover","data-testid":"img-product"}),t.isPopular&&e.jsxs(M,{className:"absolute top-4 left-4 bg-bright-orange text-white",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),"Популярное"]})]})}),e.jsxs("section",{className:"bg-white p-6 mt-2",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2","data-testid":"text-product-name",children:t.name}),t.weight&&e.jsx("p",{className:"text-gray-500 text-sm","data-testid":"text-product-weight",children:t.weight})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900","data-testid":"text-product-price",children:[t.price," с."]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex items-center space-x-3 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>u(-1),className:"w-8 h-8 flex items-center justify-center rounded-md bg-white shadow-sm","data-testid":"button-decrease-quantity",children:e.jsx(S,{className:"w-4 h-4 text-gray-600"})}),e.jsx("span",{className:"font-medium text-lg px-2","data-testid":"text-quantity",children:r}),e.jsx("button",{onClick:()=>u(1),className:"w-8 h-8 flex items-center justify-center rounded-md bg-white shadow-sm","data-testid":"button-increase-quantity",children:e.jsx(I,{className:"w-4 h-4 text-gray-600"})})]})})]}),t.description&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Описание"}),e.jsx("p",{className:"text-gray-600 leading-relaxed","data-testid":"text-product-description",children:t.description})]})]}),e.jsxs("div",{className:"space-y-2 mt-2",children:[t.ingredients&&e.jsx(d,{children:e.jsxs(o,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Состав"}),e.jsx("p",{className:"text-gray-600 leading-relaxed","data-testid":"text-product-ingredients",children:t.ingredients})]})}),h.length>0&&e.jsx(d,{children:e.jsxs(o,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Пищевая ценность на 100г"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:h.map(s=>e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xl font-bold text-gray-900","data-testid":`text-nutrition-${s.label.toLowerCase()}`,children:[s.value,s.unit]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.label})]},s.label))})]})}),e.jsx(d,{children:e.jsxs(o,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Информация о товаре"}),e.jsxs("div",{className:"space-y-3",children:[t.manufacturer&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Производитель"}),e.jsx("span",{className:"font-medium","data-testid":"text-product-manufacturer",children:t.manufacturer})]}),t.countryOfOrigin&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Страна происхождения"}),e.jsx("span",{className:"font-medium","data-testid":"text-product-country",children:t.countryOfOrigin})]}),t.shelfLife&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Срок годности"}),e.jsx("span",{className:"font-medium","data-testid":"text-product-shelf-life",children:t.shelfLife})]}),t.storageConditions&&e.jsxs(e.Fragment,{children:[e.jsx(N,{}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"Условия хранения:"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 leading-relaxed","data-testid":"text-product-storage",children:t.storageConditions})]})]})]})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-30",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(g,{onClick:()=>c.mutate(),disabled:c.isPending,className:"w-full bg-agent-purple hover:bg-agent-purple/90 text-white h-12 text-lg font-semibold","data-testid":"button-add-to-cart",children:[e.jsx(L,{className:"w-5 h-5 mr-2"}),c.isPending?"Добавляем...":`Добавить в корзину • ${(parseFloat(t.price)*r).toFixed(0)} с.`]})})})]})}export{G as default};
